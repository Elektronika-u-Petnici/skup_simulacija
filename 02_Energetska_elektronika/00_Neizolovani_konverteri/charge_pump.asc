Version 4
SHEET 1 11460 3748
WIRE 1680 336 1600 336
WIRE 1808 336 1680 336
WIRE 2512 336 2400 336
WIRE 2608 336 2512 336
WIRE 2752 336 2608 336
WIRE 1808 368 1808 336
WIRE 2400 368 2400 336
WIRE 4128 368 4032 368
WIRE 4256 368 4128 368
WIRE 1920 384 1856 384
WIRE 1952 384 1920 384
WIRE 2096 384 2064 384
WIRE 2160 384 2096 384
WIRE 2304 384 2224 384
WIRE 2352 384 2304 384
WIRE 3264 384 3168 384
WIRE 3392 384 3264 384
WIRE 736 416 688 416
WIRE 768 416 736 416
WIRE 4032 416 4032 368
WIRE 2304 432 2304 384
WIRE 3168 432 3168 384
WIRE 688 480 688 416
WIRE 2304 528 2304 496
WIRE 2608 528 2608 336
WIRE 3168 528 3168 512
WIRE 4032 528 4032 496
WIRE 1808 576 1808 464
WIRE 2000 576 1808 576
WIRE 2144 576 2080 576
WIRE 2400 576 2400 464
WIRE 2400 576 2208 576
WIRE 688 592 688 560
WIRE 1600 592 1600 336
WIRE 2752 592 2752 336
WIRE 3248 608 3168 608
WIRE 3328 608 3248 608
WIRE 4128 608 4032 608
WIRE 4256 608 4128 608
WIRE 1808 656 1808 576
WIRE 2400 656 2400 576
WIRE 3168 656 3168 608
WIRE 4032 656 4032 608
WIRE 2608 688 2608 592
WIRE 736 720 688 720
WIRE 768 720 736 720
WIRE 1920 736 1856 736
WIRE 1952 736 1920 736
WIRE 2096 736 2064 736
WIRE 2160 736 2096 736
WIRE 2304 736 2224 736
WIRE 2352 736 2304 736
WIRE 3168 768 3168 736
WIRE 4032 768 4032 736
WIRE 688 784 688 720
WIRE 2304 784 2304 736
WIRE 688 896 688 864
WIRE 1600 944 1600 672
WIRE 1808 944 1808 752
WIRE 2304 944 2304 848
WIRE 2400 944 2400 752
WIRE 2608 944 2608 768
WIRE 2752 944 2752 672
FLAG 2304 944 0
FLAG 1920 736 G1
FLAG 1920 384 G2
FLAG 2304 528 0
FLAG 2096 736 G2
FLAG 2096 384 G1
FLAG 3168 528 0
FLAG 3168 768 0
FLAG 3264 384 output_power
FLAG 3248 608 input_power
FLAG 4032 528 0
FLAG 4128 368 efficiency
FLAG 4032 768 0
FLAG 4128 608 losses
FLAG 1680 336 vin
FLAG 2512 336 vout
FLAG 688 896 0
FLAG 688 592 0
FLAG 736 416 G1
FLAG 736 720 G2
FLAG 1808 944 0
FLAG 1600 944 0
FLAG 2400 944 0
FLAG 2608 944 0
FLAG 2752 944 0
SYMBOL cap 2208 560 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value {Cf}
SYMBOL cap 2624 592 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C2
SYMATTR Value {Cf}
SYMBOL cap 2160 720 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL diode 2320 784 M0
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL voltage 1600 576 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vbat}
SYMBOL res 2736 576 R0
SYMATTR InstName R2
SYMATTR Value 10
SYMBOL cap 2160 368 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C9
SYMATTR Value 100n
SYMBOL diode 2320 432 M0
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL pmos 1856 464 R180
SYMATTR InstName M1
SYMATTR Value AO6407
SYMBOL nmos 1856 656 M0
SYMATTR InstName M2
SYMATTR Value AO4630_N
SYMBOL pmos 2352 656 R0
SYMATTR InstName M3
SYMATTR Value AO6407
SYMBOL nmos 2352 464 M180
SYMATTR InstName M4
SYMATTR Value AO4630_N
SYMBOL bv 3168 416 R0
SYMATTR InstName B1
SYMATTR Value V= if(time >  start_time, idt(V(vout)*I(R2))/(time - start_time),0)
SYMBOL bv 3168 640 R0
SYMATTR InstName B2
SYMATTR Value V=if(time > start_time, -idt(V(vin)*I(V2)) / (time - start_time),0)
SYMBOL bv 4032 640 R0
SYMATTR InstName B3
SYMATTR Value V=  V(input_power) - V(output_power)
SYMBOL bv 4032 400 R0
SYMATTR InstName B4
SYMATTR Value V= min(max(V(output_power) / V(input_power),0), 1)
SYMBOL voltage 688 768 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -575 59 Left 2
SYMATTR Value PULSE(0 3.6 0 10n 10n {d / fsw} {1 / fsw})
SYMATTR InstName V1
SYMBOL voltage 688 464 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -660 86 Left 2
SYMATTR Value PULSE(0 3.6 500n 10n 10n {d / fsw - 500n} {1 / fsw})
SYMATTR InstName V3
SYMBOL res 2096 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 4m
SYMBOL res 2624 784 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 4m
TEXT 1264 416 Left 2 !.param fsw 50k
TEXT 1264 448 Left 2 !.param d = 0.5
TEXT 1896 872 Left 2 !.param Cf = 100u
TEXT 1264 480 Left 2 !.tran 2m uic
TEXT 1264 384 Left 2 !.param Vbat 4.2
TEXT 3400 408 Left 2 !.param start_time = 0.5m
